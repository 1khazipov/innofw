# @package _global_
defaults:
  - _self_
  - override /models: deeplabv3plus
  - override /datasets: semantic-segmentation/forest-afs/310122-hdf5
  - override /losses: semantic-segmentation/dice
  - override /optimizers: adam
  - override /schedulers: custom_old_pipeline
  - override /augmentations_train: forest-bin-seg
  - override /augmentations_val: forest-bin-seg
  # - override /metrics: basic
  - override /loggers: wandb
  # - override /callbacks: basic
  # - override /trainers: basic_on_gpu_0
  # - override /checkpoints:
  # - override /wandb: default

# metrics computation
#     IoUBatch(threshold=0.5, reduction='mean'), 
#     FScoreBatch(threshold=0.5, reduction='mean')

schedulers:
  implementations:
    torch:
      Custom:
        function:
          _target_: torch.optim.lr_scheduler.LambdaLR
          lr_lambda:
            decay: 0.01
            decay_step: 1.2
            cyclic_decay: 0.7
            cyclic_len: 90

optimizers:
  implementations:
    torch:
      Adam:
        function:
          lr: 3e-6  # 1e-5  # check
          weight_decay: 1e-4

losses:
  implementations:
    torch:
      DiceLoss:
        weight: 1
        object:
          from_logits: False
          _target_: pytorch_toolbelt.losses.DiceLoss
          mode: binary

      # DiceLoss:
      #   object:
      #     mode: log
      #     alpha: 0.12094594594594596
      #     beta: 1.2
      #     gamma: 0.3
      # FocalLoss:
      #   object:
      #     balanced: True
      #     alpha: 0.12094594594594596
      #     gamma: 2
      #     smooth: 0.1
      # SurfaceLoss:
      #   weight: 0.01
      #   object:
      #     scheduler: "lambda m, i: min(0.3, m + i * 0.025)"  # todo: add it to the readme

datasets:
  batch_size: 16  # 5 in original
  num_workers: 8
  # todo: add random seed

models:
  _target_: segmentation_models_pytorch.DeepLabV3Plus
  in_channels: 3  # todo: it should be 3
  classes: 1
  encoder_name: resnet101
  encoder_weights: imagenet
  activation: sigmoid

project: forest-afs
task: image-segmentation
random_seed: 42
accelerator: gpu
devices: 1
batch_size: 5
num_workers: 32


#  f1 score should be .9!!!